<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="561px" preserveAspectRatio="none" style="width:968px;height:561px;" version="1.1" viewBox="0 0 968 561" width="968px" zoomAndPan="magnify"><defs><filter height="300%" id="f5i1ii99gbdma" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="433.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="159.5" y="69.4297"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="375.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="267.5" y="98.5625"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="317.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="375.5" y="127.6953"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="113.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="517.5" y="156.8281"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="517.5" y="386.7578"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="684.5" y="299.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="35" x2="35" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="164.5" x2="164.5" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="272.5" x2="272.5" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="380.5" x2="380.5" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="522.5" x2="522.5" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="689.5" x2="689.5" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="832" x2="832" y1="38.2969" y2="521.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="915" x2="915" y1="38.2969" y2="521.2891"/><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="15" y="22.9951">Kafka</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="8" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="15" y="540.2842">Kafka</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="118.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="125.5" y="22.9951">Subscriber</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="118.5" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="125.5" y="540.2842">Subscriber</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="220.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="227.5" y="22.9951">ServiceLayer</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="220.5" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="227.5" y="540.2842">ServiceLayer</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="334.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="341.5" y="22.9951">EntityActor</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="334.5" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="341.5" y="540.2842">EntityActor</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="494.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="501.5" y="22.9951">Entity</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="52" x="494.5" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="501.5" y="540.2842">Entity</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="78" x="648.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="655.5" y="22.9951">Publisher</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="78" x="648.5" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="64" x="655.5" y="540.2842">Publisher</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="805" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="812" y="22.9951">Kafka</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="805" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="812" y="540.2842">Kafka</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="870" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="877" y="22.9951">Cassandra</text><rect fill="#FEFECE" filter="url(#f5i1ii99gbdma)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="870" y="520.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="877" y="540.2842">Cassandra</text><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="433.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="159.5" y="69.4297"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="375.5938" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="267.5" y="98.5625"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="317.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="375.5" y="127.6953"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="113.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="517.5" y="156.8281"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="517.5" y="386.7578"/><rect fill="#FFFFFF" filter="url(#f5i1ii99gbdma)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="684.5" y="299.3594"/><polygon fill="#A80036" points="147.5,65.4297,157.5,69.4297,147.5,73.4297,151.5,69.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="35.5" x2="153.5" y1="69.4297" y2="69.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="42.5" y="64.3638">event with offset</text><polygon fill="#A80036" points="255.5,94.5625,265.5,98.5625,255.5,102.5625,259.5,98.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="169.5" x2="261.5" y1="98.5625" y2="98.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="176.5" y="93.4966">event</text><polygon fill="#A80036" points="363.5,123.6953,373.5,127.6953,363.5,131.6953,367.5,127.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="277.5" x2="369.5" y1="127.6953" y2="127.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="284.5" y="122.6294">command</text><polygon fill="#A80036" points="505.5,152.8281,515.5,156.8281,505.5,160.8281,509.5,156.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="385.5" x2="511.5" y1="156.8281" y2="156.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="392.5" y="151.7622">handle command</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="527.5" x2="569.5" y1="185.9609" y2="185.9609"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="569.5" x2="569.5" y1="185.9609" y2="198.9609"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="528.5" x2="569.5" y1="198.9609" y2="198.9609"/><polygon fill="#A80036" points="538.5,194.9609,528.5,198.9609,538.5,202.9609,534.5,198.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="534.5" y="180.895">process business logic</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="527.5" x2="569.5" y1="228.0938" y2="228.0938"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="569.5" x2="569.5" y1="228.0938" y2="241.0938"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="528.5" x2="569.5" y1="241.0938" y2="241.0938"/><polygon fill="#A80036" points="538.5,237.0938,528.5,241.0938,538.5,245.0938,534.5,241.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="534.5" y="223.0278">create new event</text><polygon fill="#A80036" points="396.5,266.2266,386.5,270.2266,396.5,274.2266,392.5,270.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="390.5" x2="521.5" y1="270.2266" y2="270.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="402.5" y="265.1606">return new event</text><polygon fill="#A80036" points="672.5,295.3594,682.5,299.3594,672.5,303.3594,676.5,299.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="385.5" x2="678.5" y1="299.3594" y2="299.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="392.5" y="294.2935">publish new event</text><polygon fill="#A80036" points="820.5,324.4922,830.5,328.4922,820.5,332.4922,824.5,328.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="689.5" x2="826.5" y1="328.4922" y2="328.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="696.5" y="323.4263">publish new event</text><polygon fill="#A80036" points="903.5,353.625,913.5,357.625,903.5,361.625,907.5,357.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="385.5" x2="909.5" y1="357.625" y2="357.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="392.5" y="352.5591">persist new event</text><polygon fill="#A80036" points="505.5,382.7578,515.5,386.7578,505.5,390.7578,509.5,386.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="385.5" x2="511.5" y1="386.7578" y2="386.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="392.5" y="381.6919">apply new event</text><polygon fill="#A80036" points="396.5,411.8906,386.5,415.8906,396.5,419.8906,392.5,415.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="390.5" x2="521.5" y1="415.8906" y2="415.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="402.5" y="410.8247">return state</text><polygon fill="#A80036" points="288.5,441.0234,278.5,445.0234,288.5,449.0234,284.5,445.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="282.5" x2="379.5" y1="445.0234" y2="445.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="294.5" y="439.9575">OK</text><polygon fill="#A80036" points="180.5,470.1563,170.5,474.1563,180.5,478.1563,176.5,474.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="174.5" x2="271.5" y1="474.1563" y2="474.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="186.5" y="469.0903">OK</text><polygon fill="#A80036" points="46.5,499.2891,36.5,503.2891,46.5,507.2891,42.5,503.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="40.5" x2="163.5" y1="503.2891" y2="503.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="52.5" y="498.2231">commit offset</text><!--
@startuml
skinparam sequenceArrowThickness 2

participant Kafka as kafkaConsume
participant Subscriber
participant "ServiceLayer" as Service
participant EntityActor
participant Entity
participant Publisher
participant Kafka as kafkaProduce

kafkaConsume -> Subscriber: event with offset

activate Subscriber
Subscriber -> Service: event

activate Service
Service -> EntityActor: command

activate EntityActor
EntityActor -> Entity: handle command

activate Entity
Entity -> Entity: process business logic
Entity -> Entity: create new event

Entity - -> EntityActor: return new event
deactivate Entity

EntityActor -> Publisher: publish new event

activate Publisher
Publisher -> kafkaProduce: publish new event
deactivate Publisher

EntityActor -> Cassandra: persist new event
EntityActor -> Entity: apply new event

activate Entity
Entity - -> EntityActor: return state
deactivate Entity

EntityActor - -> Service: OK
deactivate EntityActor

Service - -> Subscriber: OK
deactivate Service

Subscriber - -> kafkaConsume: commit offset
deactivate Subscriber

@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1248-b22
Operating System: Linux
OS Version: 4.15.0-38-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>